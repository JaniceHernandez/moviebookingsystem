<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Movie Booking App</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/react@18.2.0/umd/react.development.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/react-dom@18.2.0/umd/react-dom.development.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@babel/standalone@7.22.5/babel.min.js"></script>
</head>
<body class="bg-gray-100">
  <div id="root" class="container mx-auto p-4"></div>

  <script type="text/babel">
    function MovieCard({ movie, onSelect }) {
      return (
        <div className="bg-white rounded-lg shadow-md p-4 mb-4 hover:shadow-lg transition">
          <img src={movie.poster || 'https://via.placeholder.com/150'} alt={movie.title} className="w-full h-48 object-cover rounded-md mb-2" />
          <h2 className="text-xl font-bold">{movie.title}</h2>
          <p className="text-gray-600">Director: {movie.director}</p>
          <p className="text-gray-600">Genres: {movie.genres.join(', ')}</p>
          <p className="text-gray-600">Rating: {movie.rating.code}</p>
          <p className="text-gray-600">Status: {movie.status}</p>
          <button
            onClick={() => onSelect(movie)}
            className="mt-2 bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600"
          >
            View Showtimes
          </button>
        </div>
      );
    }

    function ShowtimeCard({ showtime }) {
      return (
        <div className="bg-white rounded-lg shadow-md p-4 mb-4">
          <p><strong>Date:</strong> {new Date(showtime.showDate).toLocaleDateString()}</p>
          <p><strong>Time:</strong> {showtime.showTime}</p>
          <p><strong>Cinema:</strong> {showtime.cinema.name} ({showtime.cinema.location})</p>
          <p><strong>Screen Type:</strong> {showtime.cinema.screenType}</p>
          <p><strong>Price:</strong> ${showtime.price}</p>
          <p><strong>Seats Available:</strong> {showtime.seatsAvailable}</p>
          <button className="mt-2 bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">
            Book Now
          </button>
        </div>
      );
    }

    function MediaGallery({ media }) {
      return (
        <div className="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4 mt-4">
          {media.length === 0 ? (
            <p>No additional media available</p>
          ) : (
            media.map(m => (
              <img
                key={m.mediaId}
                src={m.path}
                alt={`Media ${m.mediaId}`}
                className="w-full h-32 object-cover rounded-md"
              />
            ))
          )}
        </div>
      );
    }

    function App() {
      const [movies, setMovies] = React.useState([]);
      const [selectedMovie, setSelectedMovie] = React.useState(null);
      const [showtimes, setShowtimes] = React.useState([]);
      const [media, setMedia] = React.useState([]);
      const [date, setDate] = React.useState('2025-10-22');

      React.useEffect(() => {
        fetch('/api/movies')
          .then(res => res.json())
          .then(data => setMovies(data))
          .catch(err => console.error('Error fetching movies:', err));
      }, []);

      const fetchShowtimes = (movie, date) => {
        fetch(`/api/showtimes?movieId=${movie.movieId}&date=${date}`)
          .then(res => res.json())
          .then(data => {
            setShowtimes(data);
            setSelectedMovie(movie);
          })
          .catch(err => console.error('Error fetching showtimes:', err));
      };

      const fetchMedia = (movieId) => {
        fetch(`/api/media?movieId=${movieId}`)
          .then(res => res.json())
          .then(data => setMedia(data))
          .catch(err => console.error('Error fetching media:', err));
      };

      const nowShowing = movies.filter(m => m.status === 'Now Showing');
      const comingSoon = movies.filter(m => m.status === 'Coming Soon');

      return (
        <div className="p-4">
          <h1 className="text-3xl font-bold mb-6">Movie Booking App</h1>

          <h2 className="text-2xl font-semibold mb-4">Now Showing</h2>
          <div className="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4">
            {nowShowing.map(movie => (
              <MovieCard key={movie.movieId} movie={movie} onSelect={() => {
                fetchShowtimes(movie, date);
                fetchMedia(movie.movieId);
              }} />
            ))}
          </div>

          <h2 className="text-2xl font-semibold mb-4 mt-8">Coming Soon</h2>
          <div className="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4">
            {comingSoon.map(movie => (
              <MovieCard key={movie.movieId} movie={movie} onSelect={() => {
                fetchShowtimes(movie, '2025-10-24');
                fetchMedia(movie.movieId);
              }} />
            ))}
          </div>

          {selectedMovie && (
            <div className="mt-8">
              <h2 className="text-2xl font-semibold mb-4">Showtimes for {selectedMovie.title}</h2>
              <div className="mb-4">
                <label className="mr-2">Select Date:</label>
                <select
                  value={date}
                  onChange={(e) => {
                    setDate(e.target.value);
                    fetchShowtimes(selectedMovie, e.target.value);
                  }}
                  className="border rounded px-2 py-1"
                >
                  <option value="2025-10-22">October 22, 2025</option>
                  <option value="2025-10-24">October 24, 2025</option>
                </select>
              </div>
              {showtimes.length === 0 ? (
                <p>No showtimes available for {new Date(date).toLocaleDateString()}</p>
              ) : (
                <div className="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4">
                  {showtimes.map(showtime => (
                    <ShowtimeCard key={showtime.showtimeId} showtime={showtime} />
                  ))}
                </div>
              )}
              <h3 className="text-xl font-semibold mt-6 mb-2">Media Gallery</h3>
              <MediaGallery media={media} />
            </div>
          )}
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>